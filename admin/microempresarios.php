<?php
require_once 'functions.php';
$q = array(
            'path'=>'main',
            'screen'=>'loggedin',
            'classes' => 'hideSearch',
            'grandparent'=>false,
            'parent'     => false,
            'title'=>'Microempresarios'
           );
admin_filter($q, $_COOKIE);
get_header($q,'admin');
get_menu($q,'admin');
$microempresariosClass = new micros;

$orderby = i('orderby') ? i('orderby') : 'a.usuarioid';
$order = i('order') ? i('order') : 'DESC';
$offset = i('offset') ? i('offset') : 0;
$limit = i('limit') ? i('limit') : 20;
$search = i('q', $_REQUEST) ? i('q', $_REQUEST) : '';
$qe = array(
        'orderby' => $orderby,
        'order'   => $order,
        'offset'  => $offset,
        'limit'   => $limit,
        'query'   => $search
      );
$microempresarios = $microempresariosClass->get($orderby, $order, $limit, $offset, $search);
$x = $microempresariosClass->rows;
$urlbase = dir.'/admin/microempresarios.php?';
$currentPage = ($offset / $limit);
$totalPages = floor($x / $limit);
?>

<div class="binder">
  <div class="the_content">

    <header>
      <div class="title">
        Microempresarios
      </div>
      <div class="subtitle">
        Inicio
      </div>
    </header>


    <section>
      <div class="table">


        <div class="table-heads">

          <div class="showresults">
            <div class="shwr-td">
              <form action="<?= $urlbase.http_build_query($qe);?>" method="post">
              <input value="<?= $search;?>" type="text" name="q" placeholder="Buscar..."/>
              <input type="submit" value="Busca" />
              </form>
            </div>
            <div class"shwr-td">
            <label>Mostrar</label>
            <select onchange="window.location.href=$(this).find('option:selected').val()">
              <?php
              $sl = $qe;
              for($i = 5; $i <= 200; $i += 5 ):
                $sl['limit'] = $i;
                $sl['offset'] = 0;
              ?>
                <option value="<?= $urlbase.http_build_query($sl);?>" <?= $i == $limit ? 'selected' : '';?>>
                  <?= $i;?>
                </option>
              <?php endfor;?>
            </select>
            <label> resultados por página</label>
            </div>
          </div>
        <div class="pagination">
          <?php
            $io = false;
            if(0 < ($currentPage)):
            $io = true;
            $oq = $qe;
            $oq['offset'] = 0;
            endif;
          ?>
          <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
            <a href="<?= $urlbase.http_build_query($oq);?>">
              <<<<
            </a>
          </div>

        <?php
          $io = false;
          if(0 < $currentPage - 10):
          $io = true;
          $oq = $qe;
          $oq['offset'] = ($offset) - ($limit * 10);
          endif;
        ?>
        <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
          <a href="<?= $urlbase.http_build_query($oq);?>">
            <<< 10
          </a>
        </div>

        <?php
          $io = false;
          if(0 < $currentPage - 5):
          $io = true;
          $oq = $qe;
          $oq['offset'] = ($offset) - ($limit * 5);
          endif;
        ?>
        <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
          <a href="<?= $urlbase.http_build_query($oq);?>">
            << 5
          </a>
        </div>



        <?php
          $io = false;
          if(0 < $currentPage - 1):
          $io = true;
          $oq = $qe;
          $oq['offset'] = ($offset) - ($limit);
          endif;
        ?>
        <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
          <a href="<?= $urlbase.http_build_query($oq);?>">
            <
          </a>
        </div>

          <div class="pag-td pag-title">
            Página <?= $currentPage.'/'.$totalPages;?>
          </div>

          <?php
            $io = false;
            if(($currentPage + 1) <= $totalPages):
            $io = true;
            $oq = $qe;
            $oq['offset'] = ($offset) + ($limit);
            endif;
          ?>
          <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
            <a href="<?= $urlbase.http_build_query($oq);?>">
              >
            </a>
          </div>

          <?php
            $io = false;
            if(($currentPage + 5) <= $totalPages):
            $io = true;
            $oq = $qe;
            $oq['offset'] = ($offset) + ($limit * 5);
            endif;
          ?>
          <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
            <a href="<?= $urlbase.http_build_query($oq);?>">
              >> 5
            </a>
          </div>

          <?php
            $io = false;
            if(($currentPage + 10) <= $totalPages):
            $io = true;
            $oq = $qe;
            $oq['offset'] = ($offset) + ($limit * 10);
            endif;
          ?>
          <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
            <a href="<?= $urlbase.http_build_query($oq);?>">
              >>> 10
            </a>
          </div>


          <?php
            $io = false;
            if(($currentPage) < $totalPages):
            $io = true;
            $oq = $qe;
            $oq['offset'] = $totalPages * $limit;
            endif;
          ?>
          <div class="pag-td pag-nav" style="visibility:<?= $io ? 'visible' : 'hidden';?>">
            <a href="<?= $urlbase.http_build_query($oq);?>">
              >>>>
            </a>
          </div>

        </div>

      </div>


        <div class="tr th">

          <?php
            $qu = $qe;
            $qu['orderby'] = 'a.nombre';
            $qu['order'] = 'ASC';
            $qu['offset'] = 0;
            $qu['query'] = false;
          ?>
          <div class="td td-2">
            Nombre
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_up</i>
            </a>
            <?php
              $qu['order'] = 'DESC';
            ?>
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_down</i>
            </a>
          </div>
          <?php
            $qu = $qe;
            $qu['orderby'] = 'a.convocatoria';
            $qu['order'] = 'ASC';
            $qu['offset'] = 0;
            $qu['query'] = false;
          ?>
          <div class="td td-2 td-right">
            Convocatoria
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_up</i>
            </a>
            <?php
              $qu['order'] = 'DESC';
            ?>
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_down</i>
            </a>
          </div>
          <?php
            $qu = $qe;
            $qu['orderby'] = 'time';
            $qu['order'] = 'ASC';
            $qu['query'] = false;
          ?>
          <div class="td td-2 td-right">
            Tiempo total
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_up</i>
            </a>
            <?php
              $qu['order'] = 'DESC';
            ?>
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_down</i>
            </a>
          </div>
          <?php
            $qu = $qe;
            $qu['orderby'] = 'a.status';
            $qu['order'] = 'ASC';
            $qu['query'] = false;
          ?>
          <div class="td td-right">
            Status
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_up</i>
            </a>
            <?php
              $qu['order'] = 'DESC';
            ?>
            <a href="<?= $urlbase.http_build_query($qu);?>">
              <i class="material-icons">arrow_drop_down</i>
            </a>
          </div>
          <div class="td td-right">
            Acciones
          </div>
        </div>

        <?php
        foreach($microempresarios as $microempresario):
        ?>
        <div class="tr tc <?= $issame ? 'tr-highlight' : '';?>">
          <div class="td td-2">
            <?= san($microempresario['nombre']);?>
          </div>
          <div class="td td-2 td-right">
            <?= san($microempresario['convocatoria']);?>
          </div>
          <div class="td td-2 td-right">
            <?= hrs($microempresario['time']);?>
          </div>
          <div class="td td-right">
            <div class="toggle">
              <input <?= $microempresario['status'] ? 'checked' : '';?> type="checkbox" class="toggle-active"  data-group="usuarios_microempresarios" value="<?= $microempresario['usuarioid'];?>">
            </div>
          </div>
          <div class="td td-right">
            <a href="<?= admin.'/visita?id='.$microempresario['usuarioid'];?>">
              Ver
            </a>
            <a href="<?= admin.'/deletemicroempresario?id='.$microempresario['usuarioid'];?>">
              <i class="material-icons">delete_forever</i>
            </a>
          </div>
        </div>
        <?php endforeach;?>


      </div>


    </section>




  </div>
</div>



<?php get_footer($q, 'admin');?>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
